<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillNex - முகப்பு</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .filter-container { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem; }
        #search-input { width: 100%; padding: 1rem; font-size: 1.1rem; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        #category-filter { width: 100%; padding: 1rem; font-size: 1.1rem; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; }
        #gigs-container { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .gig-card-link { text-decoration: none; color: inherit; display: block; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }
        .gig-card-link img { width: 100%; height: 180px; object-fit: cover; background-color: #eee; }
        .gig-content { padding: 1rem; }
        .gig-category { font-size: 0.8rem; font-weight: 600; color: #007bff; background-color: #e6f2ff; padding: 0.25rem 0.5rem; border-radius: 4px; display: inline-block; margin-bottom: 0.5rem; }
        .gig-title { font-size: 1.2rem; font-weight: 600; color: #333; margin: 0; }
        .gig-footer { padding: 1rem; border-top: 1px solid #f0f0f0; text-align: right; }
        .gig-price { font-size: 1.25rem; font-weight: 700; color: #28a745; }
        .gig-price span { font-size: 0.9rem; font-weight: 400; color: #777; }
        #loading, #no-results { text-align: center; font-size: 1.2rem; color: #777; margin-top: 3rem; }
        
        @media (min-width: 640px) {
            .filter-container { flex-direction: row; }
            #category-filter { width: auto; }
            #gigs-container { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 1024px) {
            #gigs-container { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <main class="container">
        
        <div class="filter-container">
            <input type="search" id="search-input" placeholder="என்ன சேவை தேடுகிறீர்கள்? (e.g., logo)...">
            <select id="category-filter">
                <option value="all">All Categories</option>
                <option value="graphics_design">Graphics & Design</option>
                <option value="digital_marketing">Digital Marketing</option>
                <option value="writing_translation">Writing & Translation</option>
                <option value="web_development">Web Development</option>
                <option value="other">Other</option>
            </select>
        </div>

        <h1>கிடைக்கும் சேவைகள் (Available Gigs)</h1>
        
        <div id="gigs-container">
            </div>

        <p id="loading">Approve செய்யப்பட்ட சேவைகளைப் பதிவேற்றுகிறது...</p>
        <p id="no-results" style="display: none;">நீங்கள் தேடியதற்கு Gigs எதுவும் இல்லை.</p>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Firebase Config... (மாற்றப்படவில்லை)
        const firebaseConfig = {
            apiKey: "AIzaSyDrcT2_lGYtEtnn3LKvp3M7Ou9rTG95XG8",
            authDomain: "skillnex.firebaseapp.com",
            projectId: "skillnex",
            storageBucket: "skillnex.firebasestorage.app",
            messagingSenderId: "981326730889",
            appId: "1:981326730889:web:a063a71ec8b8d2169d9858",
            measurementId: "G-HN4CVQF3GJ"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DOM Elements
        const gigsContainer = document.getElementById('gigs-container');
        const loadingP = document.getElementById('loading');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const noResultsP = document.getElementById('no-results');
        let allGigs = [];

        // (Auth State Change தேவையில்லை)

        // --- 1. Gigs-களைப் பெறுதல் ---
        async function fetchAllGigs() {
            try {
                const gigsQuery = query(collection(db, "gigs"), where("isApproved", "==", true), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(gigsQuery);
                loadingP.style.display = 'none';
                if (querySnapshot.empty) {
                    loadingP.innerText = "Approve செய்யப்பட்ட Gigs எதுவும் இல்லை.";
                    loadingP.style.display = 'block';
                    return;
                }
                querySnapshot.forEach((doc) => {
                    allGigs.push({ id: doc.id, ...doc.data() });
                });
                renderGigs(allGigs);
            } catch (error) {
                console.error("Error fetching gigs: ", error);
                loadingP.innerText = "Gigs-களைப் பெறுவதில் பிழை ஏற்பட்டது.";
            }
        }

        // --- 2. Gigs-களைக் காட்டுதல் ---
        function renderGigs(gigsToRender) {
            gigsContainer.innerHTML = '';
            if (gigsToRender.length === 0) {
                noResultsP.style.display = 'block';
            } else {
                noResultsP.style.display = 'none';
            }
            gigsToRender.forEach((gigData) => {
                let startingPrice = '--';
                if (gigData.pricing && gigData.pricing.basic && gigData.pricing.basic.price) {
                    startingPrice = gigData.pricing.basic.price;
                }
                const gigCardLink = document.createElement('a');
                gigCardLink.className = 'gig-card-link';
                gigCardLink.href = `gig-details.html?id=${gigData.id}`;
                let categoryText = gigData.category.replace('_', ' ');
                gigCardLink.innerHTML = `
                    <img src="https://via.placeholder.com/300x180?text=${encodeURIComponent(gigData.title)}" alt="Gig Image">
                    <div class="gig-content">
                        <span class="gig-category">${categoryText}</span>
                        <h3 class="gig-title">${gigData.title}</h3>
                    </div>
                    <div class="gig-footer">
                        <span class="gig-price"><span>Starting at</span> $${startingPrice}</span>
                    </div>
                `;
                gigsContainer.appendChild(gigCardLink);
            });
        }
        
        // --- 3. Filters ---
        function filterAndRenderGigs() {
            const searchText = searchInput.value.toLowerCase();
            const category = categoryFilter.value;
            const filteredGigs = allGigs.filter((gig) => {
                const categoryMatch = (category === 'all') || (gig.category === category);
                const textMatch = gig.title.toLowerCase().includes(searchText) || 
                                  (gig.description && gig.description.toLowerCase().includes(searchText));
                return categoryMatch && textMatch;
            });
            renderGigs(filteredGigs);
        }
        searchInput.addEventListener('input', filterAndRenderGigs);
        categoryFilter.addEventListener('change', filterAndRenderGigs);

        fetchAllGigs();
    </script>
</body>
</html>
