<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-C8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>படி 1: லாகின் சிஸ்டம் (v9)</title>
    <style>
        /* இது வெப்சைட்டை அழகாகக் காட்ட (CSS) */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; display: grid; place-items: center; min-height: 100vh; margin: 0; }
        .container { background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        h2 { text-align: center; color: #333; margin-top: 0; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; color: #555; font-weight: 600; }
        input[type="email"], input[type="password"] { 
            width: 100%; 
            padding: 0.8rem; 
            box-sizing: border-box; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        button { 
            width: 100%; 
            padding: 1rem; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: 700;
        }
        button:hover { background-color: #0056b3; }
        #auth-status { margin-top: 1.5rem; text-align: center; font-size: 1.1rem; }
        #logout-button { background-color: #dc3545; margin-top: 1rem; }
        #logout-button:hover { background-color: #c82333; }
        .form-toggle { text-align: center; margin-top: 1rem; }
        .form-toggle a { color: #007bff; cursor: pointer; text-decoration: underline; }
        #login-form { display: none; } /* லாகின் ஃபார்மை முதலில் மறைக்கிறோம் */
        .loading-dots { text-align: center; }
        .loading-dots::after {
            content: '.';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            40% { color: #555; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            60% { text-shadow: .25em 0 0 #555, .5em 0 0 rgba(0,0,0,0); }
            80%, 100% { text-shadow: .25em 0 0 #555, .5em 0 0 #555; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- யூசர் லாகின் செய்துள்ளாரா என்று காட்டும் இடம் -->
        <div id="auth-status">
            <p id="user-status" class="loading-dots">Loading</p>
            <button id="logout-button" style="display:none;">வெளியேறு (Logout)</button>
        </div>

        <!-- பதிவு செய்தல் ஃபார்ம் (Register Form) -->
        <div id="register-form" style="display:none;">
            <h2>புதிய கணக்கு (Register)</h2>
            <div class="form-group">
                <label for="reg-email">மின்னஞ்சல் (Email)</label>
                <input type="email" id="reg-email" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label for="reg-password">கடவுச்சொல் (Password)</label>
                <input type="password" id="reg-password" placeholder="குறைந்தது 6 எழுத்துகள்">
            </div>
            <button id="reg-btn">பதிவு செய் (Register)</button>
        </div>

        <!-- லாகின் ஃபார்ம் (Login Form) -->
        <div id="login-form" style="display:none;">
            <h2>உள்நுழை (Login)</h2>
            <div class="form-group">
                <label for="login-email">மின்னஞ்சல் (Email)</label>
                <input type="email" id="login-email" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label for="login-password">கடவுச்சொல் (Password)</label>
                <input type="password" id="login-password" placeholder="******">
            </div>
            <button id="login-btn">உள்நுழை (Login)</button>
        </div>

        <div class="form-toggle" id="toggle-container" style="display:none;">
            <span id="toggle-text">ஏற்கனவே கணக்கு உள்ளதா? </span>
            <a id="toggle-link">இங்கே லாகின் செய்யவும்</a>
        </div>
    </div>

    <!-- ********************************************** -->
    <!--          FIREBASE JAVASCRIPT SECTION           -->
    <!-- ********************************************** -->

    <!--
      IMPORTANT: This script uses <script type="module">
      This requires your file to be served from a web server (like Netlify, GitHub Pages, or a local server)
      It will NOT work if you just open the login.html file directly from your computer (file://...)
    -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration (FROM YOUR CODE)
        const firebaseConfig = {
            apiKey: "AIzaSyDrcT2_lGYtEtnn3LKvp3M7Ou9rTG95XG8",
            authDomain: "skillnex.firebaseapp.com",
            projectId: "skillnex",
            storageBucket: "skillnex.firebasestorage.app",
            messagingSenderId: "981326730889",
            appId: "1:981326730889:web:a063a71ec8b8d2169d9858",
            measurementId: "G-HN4CVQF3GJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // DOM Elements (HTML-ஐ JS உடன் இணைத்தல்)
        const userStatus = document.getElementById('user-status');
        const logoutButton = document.getElementById('logout-button');
        const registerForm = document.getElementById('register-form');
        const loginForm = document.getElementById('login-form');
        const toggleText = document.getElementById('toggle-text');
        const toggleLink = document.getElementById('toggle-link');
        const toggleContainer = document.getElementById('toggle-container');

        // Button Elements
        const regBtn = document.getElementById('reg-btn');
        const loginBtn = document.getElementById('login-btn');
        const toggleLinkBtn = document.getElementById('toggle-link');

        // --- ஃபார்ம்களை மாற்றுவதற்கான செயல்பாடு ---
        function toggleForms() {
            if (loginForm.style.display === 'none') {
                // லாகின் ஃபார்மைக் காட்டு
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                toggleText.innerText = 'புதிய கணக்கு வேண்டுமா? ';
                toggleLink.innerText = 'இங்கே பதிவு செய்யவும்';
            } else {
                // பதிவு ஃபார்மைக் காட்டு
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                toggleText.innerText = 'ஏற்கனவே கணக்கு உள்ளதா? ';
                toggleLink.innerText = 'இங்கே லாகின் செய்யவும்';
            }
        }
        // Initially show the register form
        toggleForms(); // Call it once to show the register form by default

        // --- பதிவு செய்தல் (Register) செயல்பாடு ---
        function handleRegister() {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;

            if (!email || !password) {
                alert("மின்னஞ்சல் மற்றும் கடவுச்சொல் தேவை!");
                return;
            }

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // பதிவு வெற்றி!
                    alert("வெற்றிகரமாக பதிவு செய்தீர்கள்! இப்போது லாகின் செய்யலாம்.");
                    console.log(userCredential.user);
                    toggleForms(); // லாகின் ஃபார்மைக் காட்டு
                })
                .catch((error) => {
                    // பிழை!
                    console.error(error);
                    alert("பதிவு செய்யும்போது பிழை: " + error.message);
                });
        }

        // --- லாகின் (Login) செயல்பாடு ---
        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                alert("மின்னஞ்சல் மற்றும் கடவுச்சொல் தேவை!");
                return;
            }

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // லாகின் வெற்றி!
                    console.log(userCredential.user);
                    alert("வெற்றிகரமாக உள்நுழைந்தீர்கள்!");
                })
                .catch((error) => {
                    // பிழை!
                    console.error(error);
                    alert("லாகின் செய்யும்போது பிழை: " + error.message);
                });
        }

        // --- வெளியேறு (Logout) செயல்பாடு ---
        function handleLogout() {
            signOut(auth).then(() => {
                alert("வெளியேறிவிட்டீர்கள்.");
            }).catch((error) => {
                console.error(error);
                alert("வெளியேறும்போது பிழை: " + error.message);
            });
        }

        // --- யூசர் லாகின் செய்துள்ளாரா என்று சோதித்தல் ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // யூசர் லாகின் செய்துள்ளார்
                userStatus.innerText = "வரவேற்கிறோம், " + user.email;
                logoutButton.style.display = 'block'; // Logout பட்டனைக் காட்டு
                
                // லாகின் செய்திருப்பதால், ஃபார்ம்களை மறைக்கிறோம்
                registerForm.style.display = 'none';
                loginForm.style.display = 'none';
                toggleContainer.style.display = 'none';

            } else {
                // யூசர் லாகின் செய்யவில்லை
                userStatus.innerText = "நீங்கள் இன்னும் லாகின் செய்யவில்லை.";
                logoutButton.style.display = 'none'; // Logout பட்டனை மறை

                // லாகின் செய்யவில்லை என்றால், ஃபார்ம்களைக் காட்டுகிறோம்
                toggleContainer.style.display = 'block';
                // Show the correct form (default to register)
                if (loginForm.style.display !== 'block') {
                    registerForm.style.display = 'block';
                }
            }
        });

        // --- Event Listeners (பட்டன்களை இணைத்தல்) ---
        // We do this because onclick="" doesn't work inside a <script type="module">
        regBtn.addEventListener('click', handleRegister);
        loginBtn.addEventListener('click', handleLogin);
        logoutButton.addEventListener('click', handleLogout);
        toggleLinkBtn.addEventListener('click', toggleForms);

    </script>
</body>
</html>
